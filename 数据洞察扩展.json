{
  "id": "data_insight",
  "name": "数据洞察扩展",
  "description": "实时统计应用内的任务完成情况，提供数据可视化看板。",
  "author": "Essenmelia",
  "version": "1.0.0",
  "icon_code": 58573,
  "icon_font": "MaterialIcons",
  "permissions": [
    "read_events"
  ],
  "view": {
    "type": "scaffold",
    "appBar": {
      "title": "数据洞察",
      "actions": [
        {
          "type": "iconButton",
          "icon": 58834,
          "onPressed": "refreshData"
        }
      ]
    },
    "body": {
      "type": "column",
      "padding": 16,
      "children": [
        {
          "type": "card",
          "child": {
            "type": "listTile",
            "leading": { "type": "icon", "icon": 58573 },
            "title": "总任务数",
            "subtitle": "${state.totalCount ?? 0}"
          }
        },
        {
          "type": "card",
          "child": {
            "type": "listTile",
            "leading": { "type": "icon", "icon": 58631, "color": "green" },
            "title": "已完成",
            "subtitle": "${state.completedCount ?? 0}"
          }
        }
      ]
    }
  },
  "logic": {
    "onLoad": [
      "refreshData"
    ],
    "onEvent": {
      "read_events": [ "refreshData" ]
    },
    "actions": {
      "refreshData": [
        { "api.call": { "method": "getEvents", "target": "state.events" } },
        { "state.set": { "totalCount": "${state.events.length}" } },
        { "state.set": { "completedCount": "${state.events.where(e => e.isCompleted).length}" } }
      ]
    }
  }
}
